========================================
   AUTHENTICATION & AUTHORIZATION SYSTEM
========================================

âœ… Complete authentication system with proper route protection!

========================================
TOKEN STORAGE - BACKEND
========================================

ğŸ“¦ WHERE TOKENS ARE STORED:
   - Backend stores JWT tokens in httpOnly cookies
   - Cookie name: "token"
   - Expiry: 24 hours
   - Flags: httpOnly, sameSite: 'strict'

âœ… SECURITY FEATURES:
   - httpOnly: JavaScript cannot access the cookie (XSS protection)
   - sameSite: 'strict': CSRF protection
   - Secure transmission: Always sent with credentials
   - Auto-expires: After 24 hours

ğŸ“ TOKEN CREATION:
   - On Registration: User gets token immediately
   - On Login: User gets token
   - Token contains: userId

========================================
ROUTE PROTECTION SYSTEM
========================================

ğŸ” 4 TYPES OF ROUTES:

1. PUBLIC ROUTES (Everyone can access)
   âœ… Home page (/)
   âœ… Jobs listing (/jobs)
   âœ… Browse jobs (/browse)
   âœ… Job details (/description/:id)
   
   Behavior:
   - No authentication needed
   - Anyone can view
   - Login/Apply prompts shown for non-auth users

2. AUTH-ONLY ROUTES (Must be logged out)
   âœ… Login page (/login)
   âœ… Signup page (/signup)
   
   Behavior:
   - Only for non-authenticated users
   - If user is logged in â†’ Redirects based on role:
     * Recruiter â†’ /admin/companies
     * Student â†’ /

3. STUDENT-PROTECTED ROUTES (Students only)
   âœ… Profile page (/profile)
   
   Behavior:
   - Must be logged in as student
   - If not logged in â†’ Redirects to /login
   - If recruiter tries â†’ Redirects to / with error

4. RECRUITER-PROTECTED ROUTES (Recruiters only)
   âœ… Admin Companies (/admin/companies)
   âœ… Create Company (/admin/companies/create)
   âœ… Edit Company (/admin/companies/:id)
   âœ… Admin Jobs (/admin/jobs)
   âœ… Create Job (/admin/jobs/create)
   âœ… View Applicants (/admin/jobs/:id/applicants)
   
   Behavior:
   - Must be logged in as recruiter
   - If not logged in â†’ Redirects to /login
   - If student tries â†’ Redirects to / with error

========================================
AUTHENTICATION FLOW
========================================

ğŸ“ SIGNUP FLOW:
   1. User fills signup form
   2. Backend creates account + sends OTP email
   3. Backend returns token in cookie
   4. Frontend stores user in Redux
   5. User redirected to /verify-otp
   6. User enters OTP
   7. Email verified âœ…
   8. User redirected to dashboard

ğŸ” LOGIN FLOW:
   1. User enters credentials
   2. Backend validates + returns token
   3. Token stored in cookie
   4. Frontend stores user in Redux
   5. User redirected based on role

ğŸšª LOGOUT FLOW:
   1. User clicks logout
   2. Backend clears cookie
   3. Frontend clears Redux store
   4. User redirected to home

========================================
JOB APPLICATION PROTECTION
========================================

ğŸ¯ APPLY FOR JOB:
   When user clicks "Apply Now":
   
   1. Check if user is logged in
      âŒ Not logged in â†’ Toast: "Please login to apply"
      âœ… Logged in â†’ Continue
   
   2. Check if user is student
      âŒ Recruiter â†’ Toast: "Only job seekers can apply"
      âœ… Student â†’ Continue
   
   3. Apply to job
      âœ… Success â†’ Update UI
      âŒ Error â†’ Show error message

========================================
ROUTE COMPONENTS CREATED
========================================

1. PublicRoute.jsx
   - Wraps login/signup pages
   - Redirects authenticated users away
   - Prevents logged-in users from seeing auth pages

2. StudentProtectedRoute.jsx
   - Wraps student-only pages
   - Checks authentication
   - Checks role === 'student'
   - Shows error toast + redirects if unauthorized

3. RecruiterProtectedRoute.jsx (admin/ProtectedRoute.jsx)
   - Wraps recruiter-only pages
   - Checks authentication
   - Checks role === 'recruiter'
   - Shows error toast + redirects if unauthorized

4. ProtectedRoute.jsx (General)
   - For pages that need any authentication
   - Doesn't check role
   - Just checks if user exists

========================================
USER EXPERIENCE FLOWS
========================================

ğŸ“± SCENARIO 1: Guest User
   âœ… Can browse home, jobs, job details
   âŒ Cannot apply for jobs â†’ Redirects to login
   âŒ Cannot access profile â†’ Redirects to login
   âŒ Cannot access admin pages â†’ Redirects to login

ğŸ“± SCENARIO 2: Logged-in Student
   âœ… Can browse all public pages
   âœ… Can apply for jobs
   âœ… Can access profile
   âŒ Cannot access admin pages â†’ Redirected home
   âŒ Cannot see login/signup â†’ Redirected home

ğŸ“± SCENARIO 3: Logged-in Recruiter
   âœ… Can browse public pages
   âœ… Can access all admin pages
   âŒ Cannot apply for jobs â†’ Error shown
   âŒ Cannot access student profile â†’ Redirected home
   âŒ Cannot see login/signup â†’ Redirected admin

========================================
ERROR MESSAGES & TOASTS
========================================

ğŸ”´ Authentication Errors:
   "Please login to access this page"
   "Please login to apply for this job"
   "Please login as a recruiter to access this page"

ğŸ”´ Authorization Errors:
   "Access denied. This page is for job seekers only."
   "Access denied. This page is for recruiters only."
   "Only job seekers can apply for jobs"

âœ… Success Messages:
   "Welcome back [name]"
   "Logged out successfully"
   "Application submitted successfully"

========================================
SECURITY FEATURES
========================================

âœ… XSS Protection:
   - httpOnly cookies
   - Can't access token via JavaScript
   - Prevents token theft

âœ… CSRF Protection:
   - sameSite: 'strict'
   - Token only sent to same domain
   - Prevents cross-site attacks

âœ… Password Security:
   - Bcrypt hashing (10 rounds)
   - Never stored in plain text
   - Never sent to frontend

âœ… Token Expiry:
   - 24-hour validity
   - Auto-logout after expiry
   - Must login again

âœ… Role-Based Access:
   - Server-side validation
   - Frontend enforcement
   - Double-layer security

========================================
BACKEND TOKEN VALIDATION
========================================

ğŸ”’ isAuthenticated Middleware:
   - Checks if token exists in cookies
   - Verifies token signature
   - Extracts userId
   - Attaches to req.id
   - Used in protected routes

ğŸ“ Protected Backend Routes:
   - /api/v1/user/profile/update
   - /api/v1/application/*
   - /api/v1/company/* (recruiter only)
   - /api/v1/job/post (recruiter only)

========================================
REDUX STATE MANAGEMENT
========================================

ğŸ“¦ Auth State Structure:
   {
     user: {
       _id,
       fullname,
       email,
       phoneNumber,
       role,
       isVerified,
       profile: {
         profilePhoto,
         bio,
         skills,
         resume
       }
     },
     loading: false
   }

ğŸ”„ State Updates:
   - On login â†’ setUser(userData)
   - On signup â†’ setUser(userData)
   - On logout â†’ setUser(null)
   - On profile update â†’ setUser(updatedUser)

========================================
BEST PRACTICES IMPLEMENTED
========================================

âœ… Secure token storage (httpOnly cookies)
âœ… Role-based access control
âœ… Client-side route protection
âœ… Server-side validation
âœ… Proper error handling
âœ… User-friendly error messages
âœ… Auto-redirect on auth state change
âœ… Protected API endpoints
âœ… Token expiry handling
âœ… XSS & CSRF protection

========================================
TESTING CHECKLIST
========================================

â–¡ Test as Guest:
  â–¡ Browse public pages âœ…
  â–¡ Try to apply â†’ Redirect to login âœ…
  â–¡ Try admin pages â†’ Redirect to login âœ…

â–¡ Test as Student:
  â–¡ Login successfully âœ…
  â–¡ Apply for jobs âœ…
  â–¡ Access profile âœ…
  â–¡ Try admin pages â†’ Redirected home âœ…
  â–¡ Logout successfully âœ…

â–¡ Test as Recruiter:
  â–¡ Login successfully âœ…
  â–¡ Access admin pages âœ…
  â–¡ Try to apply â†’ Error shown âœ…
  â–¡ Try student profile â†’ Redirected âœ…
  â–¡ Logout successfully âœ…

â–¡ Test Protected Routes:
  â–¡ Login/Signup redirect when logged in âœ…
  â–¡ Profile requires student auth âœ…
  â–¡ Admin requires recruiter auth âœ…
  â–¡ Apply requires student auth âœ…

========================================
SUMMARY
========================================

ğŸ¯ TOKEN LOCATION:
   Backend stores in httpOnly cookies
   
ğŸ¯ UNAUTHENTICATED USER:
   Can browse public pages
   Redirected to /login for protected actions
   
ğŸ¯ AUTHENTICATED USER:
   Full access based on role
   Cannot access login/signup
   Redirected to appropriate dashboard
   
ğŸ¯ JOB APPLICATION:
   Requires login as student
   Shows appropriate error/redirect
   
ğŸ¯ SECURITY:
   âœ… httpOnly cookies
   âœ… Role-based access
   âœ… Token expiry
   âœ… CSRF protection
   âœ… XSS protection

========================================
PERFECT FLOW ACHIEVED! âœ…
========================================

The system now implements industry-standard
authentication and authorization with proper
security measures and user experience.

========================================
